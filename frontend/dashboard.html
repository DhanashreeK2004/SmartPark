<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parking Dashboard</title>
<style>
/* your existing CSS above */

/* Page fade */
body {
    opacity: 0;
    transition: opacity 0.4s ease-in-out;
}

body.loaded {
    opacity: 1;
}

/* Slot fade animation */
.fade {
    opacity: 0;
    transition: opacity 0.8s ease;
}

.show {
    opacity: 1;
}
</style>

<style>

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Segoe UI', sans-serif;
 letter-spacing:1px;

}

body{
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background: linear-gradient(135deg,#4C1A57,#00A8AA);
    overflow:hidden;
    position:relative;
    color:white;
}

/* Background Glass Container */
.dashboard{
    width:90%;
    max-width:800px;
    padding:40px;
    border-radius:30px;
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    border:1px solid rgba(255,255,255,0.2);
    box-shadow:0 20px 60px rgba(0,0,0,0.3);
    position:relative;
    overflow:hidden;
}

/* Car image */
.car{
    position:absolute;
    top:-150px;
    left:30px;
    width:250px;
    opacity:0.95;transform:rotate(145deg);z-index:0;
}

/* Top bar */
.top-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.top-bar,
.slot-section,
.release-btn,
.bottom-info,
.profile-btn{
    position:relative;
    z-index:2;
}
.top-bar h1{
    font-size:48px;
    font-weight:600;
}
.square{
    position:absolute;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-radius:20px;
    border:1px solid rgba(255,255,255,0.2);
}


/* Bottom Left */
.square.bottom-right{
    width:500px;
    height:500px;
    bottom:-80px;
right:-60px;
    transform: rotate(45deg);
}


.logout{
    padding:12px 25px;
    border:none;
    border-radius:15px;
    background:rgba(255,255,255,0.2);
    color:white;
    font-size:16px;
    cursor:pointer;
    transition:0.3s;
}

.logout:hover{
    background:rgba(255,255,255,0.35);
}

/* Slot Cards Section */
.slot-section{
    margin-top:50px;
    display:flex;
    gap:30px;
    flex-wrap:wrap;
}

.card{
    flex:1;
    min-width:250px;
    padding:30px;
    border-radius:25px;
    background: linear-gradient(135deg,#4C1A57,#00A8AA);
    box-shadow:0 10px 30px rgba(0,0,0,0.3);
}

.card h3{margin-left:80px;
    font-weight:400;
    opacity:0.8;
}

.card p{
margin-left:80px;
    font-size:32px;
    margin-top:10px;
    font-weight:600;
}

.card img{width:60px;height:80px;float:left;}

/* Release Button */
.release-btn{
    margin-top:40px;
    width:100%;
    padding:18px;
    border:none;
    border-radius:20px;
    font-size:20px;
    font-weight:600;
    background: linear-gradient(135deg,#00A8AA,#4C1A57);
    color:white;
    cursor:pointer;
    transition:0.3s;
}

.release-btn:hover{
    transform:scale(1.03);
}
.main-btn{
    width:100%;
    padding:15px;
    border:none;
    border-radius:30px;
    font-size:18px;
    cursor:pointer;
    background: linear-gradient(135deg,#4C1A57,#00A8AA);
    color:white;
    transition:0.3s;
}

.main-btn:hover{
    opacity:0.8;
}

/* Bottom Info */
.bottom-info{
    margin-top:40px;
    font-size:16px;
    opacity:0.9;
}

.bottom-info{ letter-spacing:1px;
}
#slotSection{
    display:none;
}
.fade-effect{display:none;}
.cards{
    display:flex;
    gap:20px;
    margin-bottom:30px;margin-top:20px;
}




/* ===== Logout Modal ===== */

.modal{
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,0.4);
    display:flex;
    justify-content:center;
    align-items:center;
    visibility:hidden;
    opacity:0;
    transition:0.3s ease;
}

.modal.show{
    visibility:visible;
    opacity:1;
}

.modal-content{
    width:320px;
    padding:30px;
    border-radius:20px;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border:1px solid rgba(255,255,255,0.2);
    text-align:center;
    color:white;
    box-shadow:0 8px 32px rgba(0,0,0,0.4);
}

.modal-content h3{
    margin-bottom:10px;
}

.modal-content p{
    font-size:14px;
    margin-bottom:25px;
    opacity:0.9;
}

.modal-buttons{
    display:flex;
    justify-content:space-between;
}

.modal-buttons button{
    width:45%;
    padding:10px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:500;
    transition:0.3s;
}

.cancel-btn{
    background: rgba(255,255,255,0.3);
    color:white;
}

.cancel-btn:hover{
    background: rgba(255,255,255,0.5);
}

.confirm-btn{
    background: linear-gradient(135deg,#4C1A57,#00A8AA);
    color:white;
}

.confirm-btn:hover{
    opacity:0.85;
}
.fade-effect{opacity:0;transition:opacity 0.4s ease-in-out;}
.fade-effect.show{opacity:1;}


/* ===== DASHBOARD MOBILE FIX ===== */
@media (max-width: 768px){

    body{
        overflow:auto;
        padding:20px;
        align-items:flex-start;
        justify-content:center;
    }

    .dashboard{
        width:100% !important;
        max-width:420px !important;
        padding:30px 20px !important;
        border-radius:25px;
    }

    /* Stack header properly */
    .top-bar{
        flex-direction:column !important;
        align-items:flex-start !important;
        gap:10px;
    }

    .top-bar h1{
        font-size:22px !important;
    }

    .logout{
        padding:8px 15px;
        font-size:14px;
    }

    /* Car smaller but same angle */
    .car{
        width:150px !important;
        top:-70px !important;
        left:15px !important;
        transform:rotate(145deg);
    }

    /* Stack cards vertically */
    .cards{
        flex-direction:column !important;
        gap:18px !important;
    }

    .card{
        width:100% !important;
        min-width:100% !important;
        padding:20px !important;
        border-radius:18px;
    }

    .card img{
        width:45px;
        height:60px;
    }

    .card h3{
        margin-left:60px !important;
        font-size:16px;
    }

    .card p{
        margin-left:60px !important;
        font-size:20px;
    }

    .release-btn,
    .main-btn{
        padding:14px !important;
        font-size:16px;
    }

    .bottom-info{
        font-size:14px;
    }

    .square.bottom-right{
        width:250px;
        height:250px;
    }
}



</style>
</head>

<body>
<img src="car.png" class="car">
<div class="square bottom-right"></div>

<div class="dashboard">


<div class="top-bar">
    <h1>Welcome, <span id="welcomeUser"></span></h1>
    <button class="logout" onclick="openModal()">Logout</button>
</div>

<div id="slot-section">
<div class="cards">
    <div class="card">
<img src="loc1.png">
        <h3>Allocated Slot</h3>
        <p>#--</p>
    </div>

    <div class="card">
<img src="loc1.png">
        <h3>Slot Status</h3>
        <p>--</p>
    </div>
</div>
</div>
 <button class="main-btn" id="allocateBtn" onclick="allocateSlot()">
        Allocate Slot
    </button>

<!-- Slot Details (Hidden First) -->

    <div id="slotSection" class="fade-effect">
<div class="cards">
                   <div class="card">
<img src="loc1.png">

                <h3>Allocated Slot</h3>
                <p id="slotNumber">-</p>
            </div>

            <div class="card">
<img src="loc1.png">

                <h3>Slot Status</h3>
                <p id="slotStatus">-</p>
            </div>
        </div>

        <button class="main-btn" onclick="releaseSlot()">
            Release Slot
        </button>

    </div>

<div class="bottom-info">
    <p>Total Parking Slots: <span id="totalSlots">-</span></p>
<p>Available Slots: <span id="availableSlots">-</span></p>
</div>


</div>
<!-- Logout Modal -->
<div id="logoutModal" class="modal">
    <div class="modal-content">
        <h3>Confirm Logout</h3>
        <p>Are you sure you want to logout?</p>
        <div class="modal-buttons">
            <button class="cancel-btn" onclick="closeModal()">Cancel</button>
            <button class="confirm-btn" onclick="confirmLogout()">Yes, Logout</button>
        </div>
    </div>
</div>
<script>
// Page fade in
window.addEventListener("load", () => {
    document.body.classList.add("loaded");
});


const userId = localStorage.getItem("userId");
const userName = localStorage.getItem("userName");

// If not logged in, go back
if (!userId) {
    window.location.href = "login.html";
}

// Show user name
if(userName) {
    document.getElementById("welcomeUser").innerText = userName;
loadSlotCounts();};



function openModal(){
    document.getElementById("logoutModal").classList.add("show");
}

function closeModal(){
    document.getElementById("logoutModal").classList.remove("show");
}

function confirmLogout(){
    localStorage.clear();
    sessionStorage.clear();
    window.location.href = "index.html"; // redirect to landing page
}
async function allocateSlot(){

    const section = document.getElementById("slotSection");

    try {

        const response = await fetch(
            "http://localhost:8080/parking/allocate/" + userId,
            { method: "POST" }
        );

        if(!response.ok){
            throw new Error("Allocation failed");
        }

        const data = await response.json();

        // Hide allocate button
        document.getElementById("allocateBtn").style.display = "none";

        // Hide default slot section
        document.getElementById("slot-section").style.display = "none";

        // Show real slot section
        section.style.display = "block";

        setTimeout(() => {
            section.classList.add("show");
        }, 50);

        document.getElementById("slotNumber").innerText = "#" + data.slotNumber;
        document.getElementById("slotStatus").innerText = "Occupied";

    } catch(error){
        alert("No slots available or already allocated!");
        console.error(error);
    }loadSlotCounts();
}
async function releaseSlot(){

    try {

        const response = await fetch(
            "http://localhost:8080/parking/release/" + userId,
            { method: "POST" }
        );

        if(!response.ok){
            throw new Error("Release failed");
        }

        // Hide real slot section
        document.getElementById("slotSection").style.display = "none";

        // Show allocate button again
        document.getElementById("allocateBtn").style.display = "block";

        // Show default slot section
        document.getElementById("slot-section").style.display = "block";

    } catch(error){
        alert("Release failed!");
        console.error(error);
    }loadSlotCounts();
}
function loadSlotCounts() {
    fetch("http://localhost:8080/slots/count")
        .then(response => response.json())
        .then(data => {
            document.getElementById("totalSlots").innerText = data.total;
            document.getElementById("availableSlots").innerText = data.available;
        })
        .catch(error => {
            console.error("Error loading slot counts:", error);
        });
}


// Logout
function logout(){
    if(confirm("Do you want to logout?")){
        window.location.href = "index.html";
    }
}

</script>
</body>
</html>